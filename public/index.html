<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="description" content="ë¬´ë£Œ ì˜¨ë¼ì¸ ì„¯ë‹¤ ê²Œì„ ì‹œë®¬ë ˆì´í„° - ì¹œêµ¬ë“¤ê³¼ í•¨ê»˜ ì¦ê¸°ëŠ” ì‹¤ì‹œê°„ ì›¹ ì„¯ë‹¤ ì—°ìŠµ, ì¡±ë³´ í•™ìŠµ">
    <meta name="keywords" content="ì„¯ë‹¤, ì„¯ë‹¤ ë£°, ì„¯ë‹¤ íŒ¨, ì„¯ë‹¤ ëœ», ì„¯ë‹¤ ì‹œë®¬, ì„¯ë‹¤ ì‹œë®¬ë ˆì´í„°, ì„¯ë‹¤ ì‹œë®¬ë ˆì´ì…˜, ì˜¨ë¼ì¸ ì„¯ë‹¤, ë¬´ë£Œ ì„¯ë‹¤, ì›¹ ì„¯ë‹¤, ì‹¤ì‹œê°„ ì„¯ë‹¤, ì„¯ë‹¤ ì—°ìŠµ, ì„¯ë‹¤ ê²Œì„, ì„¯ë‹¤ ì¡±ë³´, ì„¯ë‹¤ ì¡±ë³´ ì •ë¦¬, ì„¯ë‹¤ ì¡±ë³´ í‘œ, ì„¯ë‹¤ í”Œë˜ì‹œê²Œì„, ì„¯ë‹¤ ì›”">
    <meta property="og:title" content="ì„¯ë‹¤ ì‹œë®¬ë ˆì´í„° - ì‹¤ì‹œê°„ ì›¹ ì„¯ë‹¤ ê²Œì„">
    <meta property="og:description" content="ì¹œêµ¬ë“¤ê³¼ í•¨ê»˜í•˜ëŠ” ë¬´ë£Œ ì˜¨ë¼ì¸ ì„¯ë‹¤ ì‹œë®¬ë ˆì´í„° - ì‹¤ì „ ê°™ì€ ì—°ìŠµê³¼ ì¡±ë³´ í•™ìŠµ">
    <meta property="og:url" content="https://seotda.site">
    <title>ì„¯ë‹¤ ì‹œë®¬ë ˆì´í„° - ë¬´ë£Œ ì˜¨ë¼ì¸ ì‹¤ì‹œê°„ ì›¹ ì„¯ë‹¤ ê²Œì„</title>
   <style>
    * {
        box-sizing: border-box;
        -webkit-tap-highlight-color: transparent;
    }

    body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
        margin: 0;
        padding: 16px;
        background-color: #f7f8fa;
        max-width: 100%;
        -webkit-touch-callout: none;
        -webkit-user-select: none;
        min-height: 100vh;
    }

    /* Login Container Styles */
    #loginContainer {
        max-width: 400px;
        margin: 20px auto;
        padding: 24px;
        background: white;
        border-radius: 16px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }

    #loginContainer h2 {
        margin: 0 0 24px 0;
        color: #2d3748;
        text-align: center;
        font-size: 24px;
    }

    input[type="text"] {
        width: 100%;
        padding: 12px 16px;
        margin-bottom: 16px;
        border: 2px solid #e2e8f0;
        border-radius: 8px;
        font-size: 16px;
        transition: border-color 0.2s;
    }

    input[type="text"]:focus {
        outline: none;
        border-color: #4299e1;
    }

    button {
        width: 100%;
        padding: 12px 20px;
        margin-bottom: 12px;
        border: none;
        border-radius: 8px;
        background-color: #4299e1;
        color: white;
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        transition: background-color 0.2s;
    }

    button:active {
        background-color: #3182ce;
        transform: translateY(1px);
    }

    /* Game Container Styles */
    #gameContainer {
        display: none;
        max-width: 600px;
        margin: 0 auto;
    }

    .room-info {
        background-color: white;
        padding: 16px;
        border-radius: 12px;
        margin-bottom: 20px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        box-shadow: 0 2px 4px rgba(0,0,0,0.05);
    }

    .room-code {
        font-size: 18px;
        font-weight: bold;
        color: #2d3748;
    }

    #startButton, #endButton {
        display: none;
        margin: 8px 0;
    }

    /* Players List Styles */
    #playersList {
        background: white;
        padding: 16px;
        border-radius: 12px;
        margin-bottom: 20px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.05);
    }

    #playersList h3 {
        margin: 0 0 12px 0;
        color: #2d3748;
    }

    #players {
        list-style: none;
        padding: 0;
        margin: 0;
    }

    .player-card-indicator {
        display: inline-flex;
        margin-left: 8px;
        gap: 4px;
    }

    .player-card-indicator img {
        width: 40px;
        height: 60px;
        border-radius: 2px;
    }

    #players li {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin: 15px;
    }

    #players li:last-child {
        border-bottom: none;
    }

    /* Card Container Styles */
    #myCards {
        background: white;
        padding: 16px;
        border-radius: 12px;
        margin-bottom: 20px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.05);
    }

    #myCards h3 {
        margin: 0 0 12px 0;
        color: #2d3748;
    }

    #cardContainer {
        position: relative;
        height: 180px;
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 16px;
    }

    .card {
        position: absolute;
        touch-action: none;
    }

    .card img {
        width: 120px;
        height: auto;
        border-radius: 8px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.2);
    }

    .card.final {
        position: relative;
    }

    /* Pokkal Tab Styles */
    #pokkalTab {
        background: white;
        border-radius: 12px;
        overflow: hidden;
        margin-bottom: 20px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.05);
    }

    .tab-title {
        padding: 16px;
        background-color: #2d3748;
        color: white;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .toggle-button {
        background-color: transparent;
        border: 1px solid white;
        padding: 8px 16px;
        color: white;
        font-size: 14px;
        margin: 0;
        width: auto;
    }

    .pokkal-content {
        transition: max-height 0.3s ease-out;
        max-height: 2000px;
        overflow: hidden;
    }

    .pokkal-content.hidden {
        max-height: 0;
    }

    .pokkal-list {
        list-style: none;
        padding: 16px;
        margin: 0;
    }

    .pokkal-header {
        background-color: #4a5568;
        color: white;
        padding: 8px 12px;
        margin: 16px -16px 8px -16px;
        font-weight: bold;
    }

    .pokkal-list li {
        padding: 12px 0;
        border-bottom: 1px solid #edf2f7;
        color: #4a5568;
    }

    .pokkal-list li.current {
        background-color: #ebf8ff;
        margin: 0 -16px;
        padding: 12px 16px;
        border-left: 4px solid #4299e1;
        font-weight: bold;
    }

    .error-message {
        color: #e53e3e;
        text-align: center;
        margin: 12px 0;
        font-size: 14px;
    }

    /* Mobile Optimization */
    @media (max-width: 480px) {
        body {
            padding: 12px;
        }

        .card img {
            width: 100px;
            height: auto;
        }

        #cardContainer {
            height: 150px;
        }

        .tab-title {
            font-size: 16px;
        }

        .toggle-button {
            padding: 6px 12px;
            font-size: 13px;
        }

        #loginContainer {
            padding: 20px;
        }

        input[type="text"] {
            padding: 10px 14px;
        }
    }
    </style>
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3210745097147760"
    crossorigin="anonymous"></script>
</head>
<body>
    <!-- 'ì„¯ë‹¤ë€?' ë²„íŠ¼ ë° ì„¤ëª… ì¶”ê°€ -->
    <div style="max-width: 400px; margin: 20px auto; background: white; border-radius: 16px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
        <button id="aboutSeotdaButton" class="toggle-button" style="display: block; width: 100%; background-color: #2d3748; color: white; padding: 12px; border: none; border-radius: 16px 16px 0 0; font-size: 16px; cursor: pointer;">
            ì„¯ë‹¤ë€?
        </button>
    
        <div id="aboutSeotdaContent" style="display: none; padding: 24px;">
            <div style="margin-bottom: 24px;">
                <h4 style="color: #2d3748; margin-top: 0;">ì—­ì‚¬</h4>
                <p>ì„¯ë‹¤ëŠ” ì¡°ì„ ì‹œëŒ€ë¶€í„° ì´ì–´ì ¸ ì˜¨ í•œêµ­ì˜ ì „í†µ ì¹´ë“œ ê²Œì„ì…ë‹ˆë‹¤. 'ì…‹ì§¸ì¹˜ê¸°'ì—ì„œ ìœ ë˜í•œ ì´ë¦„ìœ¼ë¡œ, í™”íˆ¬íŒ¨ë¥¼ ì´ìš©í•œ ëŒ€í‘œì ì¸ ì „í†µ ë†€ì´ì…ë‹ˆë‹¤.</p>
            </div>
    
            <div style="margin-bottom: 24px;">
                <h4 style="color: #2d3748;">ì£¼ìš” ì¡±ë³´</h4>
                <ul style="list-style: none; padding-left: 0; margin: 0;">
                    <li>â€¢ ê´‘ë•¡: 3ì›”ê³¼ 8ì›”(38ê´‘ë•¡), 1ì›”ê³¼ 3ì›”(13ê´‘ë•¡), 1ì›”ê³¼ 8ì›”(18ê´‘ë•¡)</li>
                    <li>â€¢ ë•¡: ê°™ì€ ì›”ì˜ ì¡°í•©(10ë•¡ì´ ê°€ì¥ ë†’ìŒ)</li>
                    <li>â€¢ ì•Œë¦¬: 1ì›”ê³¼ 2ì›”ì˜ ì¡°í•©</li>
                    <li>â€¢ êµ¬ì‚¬: 4ì›”ê³¼ 9ì›”ì˜ íŠ¹ìˆ˜í•œ ì¡°í•©</li>
                </ul>
            </div>
    
            <div style="margin-bottom: 24px;">
                <h4 style="color: #2d3748;">ê²Œì„ ë°©ë²•</h4>
                <ol style="padding-left: 20px; margin: 0;">
                    <li>ë°©ì„ ë§Œë“¤ê±°ë‚˜ ì°¸ì—¬í•©ë‹ˆë‹¤.</li>
                    <li>ê°ì 2ì¥ì˜ íŒ¨ë¥¼ ë°›ìŠµë‹ˆë‹¤.</li>
                    <li>ì²« ë²ˆì§¸ íŒ¨ëŠ” í„°ì¹˜ë¡œ, ë‘ ë²ˆì§¸ íŒ¨ëŠ” ë“œë˜ê·¸ë¡œ í™•ì¸í•©ë‹ˆë‹¤.</li>
                    <li>ìì‹ ì˜ íŒ¨ì™€ ì¡±ë³´ë¥¼ í™•ì¸í•˜ê³  ê²Œì„ì„ ì¦ê¹ë‹ˆë‹¤.</li>
                    <li>ë°°íŒ… ë°©ì‹ì€ í”Œë ˆì´ì–´ë“¤ ê°„ì˜ ììœ ë¡œìš´ í•©ì˜í•˜ì— ì§„í–‰í•©ë‹ˆë‹¤.</li>
                </ol>
            </div>
    
            <div style="margin-bottom: 24px;">
                <h4 style="color: #2d3748;">ì´ëŸ´ ë•Œ ì¶”ì²œí•´ìš”!</h4>
                <ul style="list-style: none; padding-left: 0; margin: 0;">
                    <li style="margin-bottom: 8px;">ğŸ¡ íœì…˜, ë¦¬ì¡°íŠ¸ì—ì„œ ì¹œêµ¬ë“¤ê³¼ í•¨ê»˜í•  ë•Œ</li>
                    <li style="margin-bottom: 8px;">ğŸ´ ì‹¤ì œ í™”íˆ¬íŒ¨ ì—†ì´ë„ ì¦ê¸°ê³  ì‹¶ì„ ë•Œ</li>
                    <li style="margin-bottom: 8px;">ğŸ‘¥ ì—¬ëŸ¿ì´ ëª¨ì˜€ëŠ”ë° ê°„ë‹¨íˆ ê²Œì„í•˜ê³  ì‹¶ì„ ë•Œ</li>
                    <li style="margin-bottom: 8px;">ğŸŒŸ ì„¯ë‹¤ ê·œì¹™ì„ ì‰½ê²Œ ë°°ìš°ê³  ì‹¶ì„ ë•Œ</li>
                </ul>
            </div>
    
            <div style="margin-top: 16px; padding-top: 16px; border-top: 1px solid #e2e8f0;">
                <p style="color: #666; font-size: 14px; margin: 0;">âœ‹ <strong>ì ê¹!</strong> ì´ ì‹œë®¬ë ˆì´í„°ëŠ” ëŒ€í™”ì™€ ì¦ê±°ì›€ì´ ìˆëŠ” ì‹¤ì œ ëª¨ì„ì„ ëŒ€ì²´í•˜ê¸° ìœ„í•œ ê²ƒì´ ì•„ë‹™ë‹ˆë‹¤. í•¨ê»˜ ëª¨ì—¬ ê²Œì„í•˜ë©´ì„œ ì´ì•¼ê¸° ë‚˜ëˆ„ëŠ” ê²ƒì„ ì¶”ì²œë“œë¦½ë‹ˆë‹¤.</p>
            </div>
        </div>
    </div>
    
    <div id="loginContainer">
        <h2>ì„¯ë‹¤ ì‹œë®¬ë ˆì´í„°</h2>
        <input type="text" id="playerName" placeholder="ë‹‰ë„¤ì„ì„ ì…ë ¥í•˜ì„¸ìš”">
        <input type="text" id="room-code-input" placeholder="ë°© ì½”ë“œ" maxlength="4">
        <button onclick="createRoom()">ë°© ë§Œë“¤ê¸°</button>
        <button onclick="joinRoom()">ì°¸ê°€í•˜ê¸°</button>
        <div class="error-message" id="error-message"></div>
    </div>

    <div id="gameContainer">
        <div class="room-info">
            <span class="room-code">ë°© ì½”ë“œ: <span id="current-room-code"></span></span>
            <button onclick="leaveRoom()" style="width: auto; margin: 0; padding: 8px 16px;">ë‚˜ê°€ê¸°</button>
        </div>

        <!-- ê²Œì„ ì‹œì‘ ë²„íŠ¼ ìœ„ ê´‘ê³  -->
        <div id="gameTopAd" style="display: none; margin: 20px 0;">
            <ins class="adsbygoogle"
                style="display:block"
                data-ad-client="ca-pub-3210745097147760"
                data-ad-slot="3795602366"
                data-ad-format="auto"
                data-full-width-responsive="true"></ins>
            <script>
                (adsbygoogle = window.adsbygoogle || []).push({});
            </script>
        </div>

        <button id="startButton" onclick="startGame()">ê²Œì„ ì‹œì‘</button>
        <button id="endButton" onclick="endGame()">ê²Œì„ ì¢…ë£Œ</button>

        <div id="playersList">
            <h3>ì°¸ê°€ì ëª©ë¡</h3>
            <ul id="players"></ul>
        </div>

        <div id="myCards">
            <h3>ë‚´ ì¹´ë“œ</h3>
            <div id="cardContainer"></div>
            <div id="cardInstructions" style="margin-top: 16px; color: #666; font-size: 14px; text-align: center;">
                <p style="margin: 4px 0;">1. ì²« ë²ˆì§¸ íŒ¨ ì˜¤í”ˆ - íŒ¨ í„°ì¹˜</p>
                <p style="margin: 4px 0;">2. ë‘ ë²ˆì§¸ íŒ¨ ì˜¤í”ˆ - íŒ¨ í„°ì¹˜ í›„ ì•„ë˜ë¡œ ë“œë˜ê·¸</p>
            </div>
        </div>

        <div id="pokkalTab">
            <div class="tab-title">
                <span>ì¡±ë³´</span>
                <button class="toggle-button" onclick="togglePokkal()">ì ‘ê¸°/í¼ì¹˜ê¸°</button>
            </div>
            <div class="pokkal-content">
                <ul class="pokkal-list">
                    <li class="pokkal-header" style="padding-left: 12px; color: white;">ì¼ë°˜ íŒ¨</li>
                    <li data-pokkal="38ê´‘ë•¡">38ê´‘ë•¡</li>
                    <li data-pokkal="13ê´‘ë•¡">13ê´‘ë•¡</li>
                    <li data-pokkal="18ê´‘ë•¡">18ê´‘ë•¡</li>
                    <li data-pokkal="10ë•¡">ì¥ë•¡</li>
                    <li data-pokkal="9ë•¡">9ë•¡</li>
                    <li data-pokkal="8ë•¡">8ë•¡</li>
                    <li data-pokkal="7ë•¡">7ë•¡</li>
                    <li data-pokkal="6ë•¡">6ë•¡</li>
                    <li data-pokkal="5ë•¡">5ë•¡</li>
                    <li data-pokkal="4ë•¡">4ë•¡</li>
                    <li data-pokkal="3ë•¡">3ë•¡</li>
                    <li data-pokkal="2ë•¡">2ë•¡</li>
                    <li data-pokkal="1ë•¡">1ë•¡</li>
                    <li data-pokkal="ì•Œë¦¬">ì•Œë¦¬</li>
                    <li data-pokkal="ë…ì‚¬">ë…ì‚¬</li>
                    <li data-pokkal="êµ¬ì‚¥">êµ¬ì‚¥</li>
                    <li data-pokkal="ì¥ì‚¥">ì¥ì‚¥</li>
                    <li data-pokkal="ì¥ì‚¬">ì¥ì‚¬</li>
                    <li data-pokkal="ì„¸ë¥™">ì„¸ë¥™</li>
                    <li data-pokkal="ê°‘ì˜¤">ê°‘ì˜¤</li>
                    <li data-pokkal="8ë—">8ë—</li>
                    <li data-pokkal="7ë—">7ë—</li>
                    <li data-pokkal="6ë—">6ë—</li>
                    <li data-pokkal="5ë—">5ë—</li>
                    <li data-pokkal="4ë—">4ë—</li>
                    <li data-pokkal="3ë—">3ë—</li>
                    <li data-pokkal="2ë—">2ë—</li>
                    <li data-pokkal="1ë—">1ë—</li>
                    <li data-pokkal="ë§í†µ">ë§í†µ</li>
                    <li class="pokkal-header" style="padding-left: 12px; color: white;">íŠ¹ìˆ˜ íŒ¨</li>
                    <li data-pokkal="êµ¬ì‚¬">êµ¬ì‚¬<br>(ê²Œì„ì— ê°€ì¥ ë†’ì€ ì¡±ë³´ê°€ ì•Œë¦¬ ì´í•˜ì¼ ê²½ìš° ìë™ì ìœ¼ë¡œ ì¬ê²½ê¸°ë¥¼ í•˜ê²Œ ëœë‹¤.)</li>
                    <li data-pokkal="ë©í……êµ¬ë¦¬êµ¬ì‚¬">ë©í……êµ¬ë¦¬êµ¬ì‚¬<br>(ê²Œì„ ê²°ê³¼ ê°€ì¥ ë†’ì€ ì¡±ë³´ê°€ ì¥ë•¡ ì´í•˜, 10ë•¡ ìœ„ë¡œ ë‚˜ì˜¤ì§€ ì•Šìœ¼ë©´ ìë™ì ìœ¼ë¡œ ì¬ê²½ê¸°ë¥¼ í•˜ê²Œ ëœë‹¤.)</li>
                    <li data-pokkal="47ì•”í–‰ì–´ì‚¬">47ì•”í–‰ì–´ì‚¬<br>(18 ê´‘ë•¡ & 13 ê´‘ë•¡ê³¼ì˜ ëŒ€ê²°ì—ì„œ ìŠ¹ë¦¬í•  ìˆ˜ ìˆë‹¤., ê´‘ë•¡ì´ ëœ¨ì§€ ì•Šì„ ê²½ìš° í•œ ë—ìœ¼ë¡œ ê°„ì£¼ëœë‹¤.)</li>
                    <li data-pokkal="37ë•¡ì¡ì´">37ë•¡ì¡ì´<br>(9ë•¡ ì´í•˜ì˜ ëª¨ë“  ë•¡ê³¼ì˜ ëŒ€ê²°ì—ì„œ ìŠ¹ë¦¬í•  ìˆ˜ ìˆë‹¤. ë•¡ì´ ëœ¨ì§€ ì•Šì„ ê²½ìš°ì—” ë§í†µìœ¼ë¡œ ê°„ì£¼ëœë‹¤.)</li>
                </ul>
            </div>
        </div>
    </div>

   <script>
       let ws;
       let playerId = null;
       let isHost = false;
       let currentRoom = null;
       let myCardNumbers = [];
       let flippedCards = 0;
       let cachedPokkal = null;
       let gameEnded = false;
       let isFirstGame = true; // ì²« ê²Œì„ ì—¬ë¶€ë¥¼ ì¶”ì í•˜ëŠ” ë³€ìˆ˜ ì¶”ê°€

       const aboutButton = document.getElementById('aboutSeotdaButton');
       const aboutContent = document.getElementById('aboutSeotdaContent');
        
       aboutButton.addEventListener('click', () => {
           const isHidden = aboutContent.style.display === 'none';
           aboutContent.style.display = isHidden ? 'block' : 'none';
           aboutButton.textContent = isHidden ? 'ì„¯ë‹¤ë€? â–¼' : 'ì„¯ë‹¤ë€?';
       });

       function preloadImages() {
           const images = [];
           images.push(new Image().src = 'image/0.png');
           for(let i = 1; i <= 10; i++) {
               images.push(new Image().src = `image/${i}.png`);
           }
           for(let i = 100; i <= 1000; i += 100) {
               images.push(new Image().src = `image/${i}.png`);
           }
           return images;
       }

       function displayCards(cards) {
           const cardContainer = document.getElementById('cardContainer');
           cardContainer.innerHTML = '';
           
           myCardNumbers = cards;
           flippedCards = 0;
           cachedPokkal = null;
           
           // ë‘ ë²ˆì§¸ ì¹´ë“œ (ë°‘ì— ê¹”ë¦° ì¹´ë“œ)
           const secondCard = document.createElement('div');
           secondCard.className = 'card';
           const secondCardImg = document.createElement('img');
           secondCardImg.src = `image/${cards[1]}.png`;  // ë‘ ë²ˆì§¸ ì¹´ë“œëŠ” ì²˜ìŒë¶€í„° ì•ë©´
           secondCard.appendChild(secondCardImg);
           
           // ì²« ë²ˆì§¸ ì¹´ë“œ (ìœ„ì— ìˆëŠ” ì¹´ë“œ)
           const firstCard = document.createElement('div');
           firstCard.className = 'card';
           const firstCardImg = document.createElement('img');
           firstCardImg.src = 'image/0.png';  // ì²˜ìŒì—ëŠ” ë’·ë©´
           firstCard.appendChild(firstCardImg);

           let isFirstCardFlipped = false;
           let isDragging = false;
           let startY = 0;

           // ì²« ë²ˆì§¸ ì¹´ë“œ í´ë¦­ ì´ë²¤íŠ¸
           firstCard.addEventListener('click', () => {
               if (!isFirstCardFlipped) {
                   firstCardImg.src = `image/${cards[0]}.png`;
                   isFirstCardFlipped = true;
                   flippedCards = 1;
               }
           });

           firstCard.addEventListener('mousedown', (e) => {
               if (isFirstCardFlipped) {
                   isDragging = true;
                   startY = e.clientY;
               }
           });

           document.addEventListener('mousemove', (e) => {
               if (isDragging && isFirstCardFlipped) {
                   let deltaY = e.clientY - startY;
                   if (deltaY > 0) {
                       firstCard.style.transform = `translateY(${deltaY}px)`;
                   }
               }
           });

           document.addEventListener('mouseup', (e) => {
               if (isDragging) {
                   const deltaY = e.clientY - startY;
                   if (deltaY > firstCardImg.height * 1) {
                       showFinalCards();
                   }
                   firstCard.style.transform = '';
                   isDragging = false;
               }
           });

           firstCard.addEventListener('touchstart', (e) => {
               if (isFirstCardFlipped) {
                   isDragging = true;
                   startY = e.touches[0].clientY;
               }
           });

           firstCard.addEventListener('touchmove', (e) => {
               if (isDragging && isFirstCardFlipped) {
                   let deltaY = e.touches[0].clientY - startY;
                   if (deltaY > 0) {
                       e.preventDefault();
                       firstCard.style.transform = `translateY(${deltaY}px)`;
                   }
               }
           });

           firstCard.addEventListener('touchend', (e) => {
               if (isDragging) {
                   const transform = firstCard.style.transform;
                   const match = transform.match(/translateY\((\d+)px\)/);
                   if (match) {
                       const deltaY = parseInt(match[1]);
                       if (deltaY > firstCardImg.height * 1) {
                           showFinalCards();
                       }
                   }
                   firstCard.style.transform = '';
                   isDragging = false;
               }
           });

           function showFinalCards() {
               cardContainer.innerHTML = '';
               
               const card1 = document.createElement('div');
               card1.className = 'card final';
               const img1 = document.createElement('img');
               img1.src = `image/${cards[0]}.png`;
               img1.dataset.cardNumber = cards[0];
               img1.dataset.isFlipped = 'true';
               img1.addEventListener('click', function() {
                   if(this.dataset.isFlipped === 'true') {
                       this.src = 'image/0.png';
                       this.dataset.isFlipped = 'false';
                   } else {
                       this.src = `image/${this.dataset.cardNumber}.png`;
                       this.dataset.isFlipped = 'true';
                   }
                   updatePokkalDisplay();
               });
               card1.appendChild(img1);
               
               const card2 = document.createElement('div');
               card2.className = 'card final';
               const img2 = document.createElement('img');
               img2.src = `image/${cards[1]}.png`;
               img2.dataset.cardNumber = cards[1];
               img2.dataset.isFlipped = 'true';
               img2.addEventListener('click', function() {
                   if(this.dataset.isFlipped === 'true') {
                       this.src = 'image/0.png';
                       this.dataset.isFlipped = 'false';
                   } else {
                    this.src = `image/${this.dataset.cardNumber}.png`;
                       this.dataset.isFlipped = 'true';
                   }
                   updatePokkalDisplay();
               });
               card2.appendChild(img2);
               
               cardContainer.appendChild(card1);
               cardContainer.appendChild(card2);
               
               flippedCards = 2;
               updatePokkalDisplay();

               function updatePokkalDisplay() {
                   const card1Flipped = img1.dataset.isFlipped === 'true';
                   const card2Flipped = img2.dataset.isFlipped === 'true';
                   
                   if (card1Flipped && card2Flipped) {
                       if (!cachedPokkal) {
                           cachedPokkal = calculatePokkal(myCardNumbers);
                       }
                       updatePokkalHighlight(cachedPokkal);
                   } else {
                       updatePokkalHighlight(null);
                   }
               }
           }

           cardContainer.appendChild(secondCard);
           cardContainer.appendChild(firstCard);
       }

       function connectWebSocket() {
           const wsProtocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';
           const wsUrl = `${wsProtocol}//${window.location.host}`;
           ws = new WebSocket(wsUrl);

           ws.onopen = () => {
               console.log('WebSocket connected');
           };

           ws.onmessage = (event) => {
               const data = JSON.parse(event.data);
               console.log('Received:', data);

               switch(data.type) {
                   case 'roomCreated':
                   case 'joinResponse':
                       handleRoomJoin(data);
                       break;
                   case 'gameState':
                       updateGameState(data);
                       break;
                   case 'cards':
                       displayCards(data.cards);
                       break;
                   case 'error':
                       showError(data.message);
                       break;
                   case 'leftRoom':
                       showLoginContainer();
                       break;
               }
           };

           ws.onclose = () => {
               console.log('WebSocket disconnected');
               setTimeout(connectWebSocket, 3000);
           };
       }

       function handleRoomJoin(data) {
           if (data.error) {
               showError(data.error);
               return;
           }

           currentRoom = data.roomCode;
           isHost = data.isHost;
           document.getElementById('current-room-code').textContent = currentRoom;
           showGameContainer();
       }

       function createRoom() {
            const playerName = document.getElementById('playerName').value.trim();
            if (!playerName) {
                showError('ë‹‰ë„¤ì„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”');
                return;
            }

            // ì¡±ë³´ í•˜ì´ë¼ì´íŠ¸ ì´ˆê¸°í™”
            updatePokkalHighlight(null);
            // ì¹´ë“œ ì»¨í…Œì´ë„ˆ ì´ˆê¸°í™”
            const cardContainer = document.getElementById('cardContainer');
            cardContainer.innerHTML = '';
            // ìºì‹œëœ ì¡±ë³´ ì´ˆê¸°í™”
            cachedPokkal = null;

            playerId = 'player_' + Math.random().toString(36).substr(2, 9);
            sendToServer({
                type: 'createRoom',
                playerId: playerId,
                playerName: playerName
            });
       }

        function joinRoom() {
            const playerName = document.getElementById('playerName').value.trim();
            const roomCode = document.getElementById('room-code-input').value.trim();
           
            if (!playerName) {
                showError('ë‹‰ë„¤ì„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”');
                return;
            }
            if (!roomCode) {
                showError('ë°© ì½”ë“œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”');
                return;
            }

            // ì¡±ë³´ í•˜ì´ë¼ì´íŠ¸ ì´ˆê¸°í™”
            updatePokkalHighlight(null);
            // ì¹´ë“œ ì»¨í…Œì´ë„ˆ ì´ˆê¸°í™”
            const cardContainer = document.getElementById('cardContainer');
            cardContainer.innerHTML = '';
            // ìºì‹œëœ ì¡±ë³´ ì´ˆê¸°í™”
            cachedPokkal = null;

            playerId = 'player_' + Math.random().toString(36).substr(2, 9);
            sendToServer({
                type: 'joinRoom',
                roomCode: roomCode,
                playerId: playerId,
                playerName: playerName
            });
       }

       function leaveRoom() {
           if (currentRoom) {
               sendToServer({
                   type: 'leaveRoom',
                   playerId: playerId,
                   roomCode: currentRoom
               });
           }
           showLoginContainer();
       }

       function sendToServer(data) {
           if (ws && ws.readyState === WebSocket.OPEN) {
               ws.send(JSON.stringify(data));
           } else {
               showError('ì„œë²„ì— ì—°ê²°ë˜ì–´ ìˆì§€ ì•ŠìŠµë‹ˆë‹¤');
           }
       }

       function showLoginContainer() {
           document.getElementById('loginContainer').style.display = 'block';
           document.getElementById('gameContainer').style.display = 'none';
           document.getElementById('loginAdsContainer').style.display = 'block';
           document.getElementById('gameTopAd').style.display = 'none';
           document.getElementById('gameBottomAd').style.display = 'none';
           document.getElementById('playerName').value = '';
           document.getElementById('room-code-input').value = '';
           currentRoom = null;
           isHost = false;
           isFirstGame = true; // ë¡œê·¸ì¸ í™”ë©´ìœ¼ë¡œ ëŒì•„ê°ˆ ë•Œ ì²« ê²Œì„ ìƒíƒœ ì´ˆê¸°í™”
       }

       function showGameContainer() {
           document.getElementById('loginContainer').style.display = 'none';
           document.getElementById('gameContainer').style.display = 'block';
           document.getElementById('loginAdsContainer').style.display = 'none';
           document.getElementById('gameTopAd').style.display = 'block';
           document.getElementById('gameBottomAd').style.display = 'block';
           document.getElementById('startButton').style.display = isHost ? 'block' : 'none';
           document.getElementById('endButton').style.display = isHost ? 'block' : 'none';

           // ì…ì¥ ì‹œ ì¹´ë“œ ì„¤ëª… í‘œì‹œ
           if (document.getElementById('cardInstructions')) {
               document.getElementById('cardInstructions').style.display = 'block';
           }
       }

       function showError(message) {
           const errorElement = document.getElementById('error-message');
           errorElement.textContent = message;
           setTimeout(() => {
               errorElement.textContent = '';
           }, 3000);
       }

       function updateGameState(state) {
            isHost = state.isHost;
            isFirstGame = state.isFirstGame; // ì„œë²„ì—ì„œ ë°›ì€ ì²« ê²Œì„ ìƒíƒœ ì ìš©
            document.getElementById('startButton').style.display = isHost ? 'block' : 'none';
            document.getElementById('endButton').style.display = isHost ? 'block' : 'none';

            // ê²Œì„ì´ ì‹œì‘ë˜ì—ˆê³  ì²« ê²Œì„ì´ ì•„ë‹ ë•Œë§Œ ì„¤ëª… ìˆ¨ê¸°ê¸°
            if (document.getElementById('cardInstructions')) {
                document.getElementById('cardInstructions').style.display = 
                    isFirstGame ? 'block' : 'none';
            }

            // ê²Œì„ì´ ì‹œì‘ë˜ë©´ ëª¨ë“  í”Œë ˆì´ì–´ì˜ ì¡±ë³´ í•˜ì´ë¼ì´íŠ¸ ì´ˆê¸°í™”
            if (state.gameStarted) {
                updatePokkalHighlight(null);
                cachedPokkal = null;
            }

            const playersList = document.getElementById('players');
            playersList.innerHTML = '';
            
            state.players.forEach(player => {
                const li = document.createElement('li');
                const playerInfo = document.createElement('span');
                playerInfo.textContent = `${player.name} ${player.isHost ? '(ë°©ì¥)' : ''}`;
                
                const cardIndicator = document.createElement('div');
                cardIndicator.className = 'player-card-indicator';
                
                if (player.hasCards && player.id !== playerId) {
                    for (let i = 0; i < 2; i++) {
                        const cardImg = document.createElement('img');
                        // ê²Œì„ì´ ì§„í–‰ì¤‘ì´ë©´ ë’·ë©´(0.png), ì•„ë‹ˆë©´ ì•ë©´(ì‹¤ì œ ì¹´ë“œ) í‘œì‹œ
                        cardImg.src = `image/${state.gameStarted ? '0' : player.cards[i]}.png`;
                        cardIndicator.appendChild(cardImg);
                    }
                }
                
                li.appendChild(playerInfo);
                li.appendChild(cardIndicator);
                playersList.appendChild(li);
            });
        }

       function calculatePokkal(cards) {
           if (cards.length !== 2) return "ì¹´ë“œ 2ì¥ì´ í•„ìš”í•©ë‹ˆë‹¤";
           
           const card1 = cards[0];
           const card2 = cards[1];
           
           const month1 = Math.floor(card1 / 100) || card1;
           const month2 = Math.floor(card2 / 100) || card2;
           const months = [month1, month2].sort((a, b) => a - b);
           
           if ((card1 === 300 && card2 === 800) || (card1 === 800 && card2 === 300)) return "38ê´‘ë•¡";
           if ((card1 === 100 && card2 === 300) || (card1 === 300 && card2 === 100)) return "13ê´‘ë•¡";
           if ((card1 === 100 && card2 === 800) || (card1 === 800 && card2 === 100)) return "18ê´‘ë•¡";
           
           if ((month1 === 4 && month2 === 9) || (month1 === 9 && month2 === 4)) {
               if (card1 !== 300 && card1 !== 800 && card2 !== 300 && card2 !== 800) {
                   return "ë©í……êµ¬ë¦¬êµ¬ì‚¬";
               }
               return "êµ¬ì‚¬";
           }

           if ((month1 === 4 && month2 === 7) || (month1 === 7 && month2 === 4)) return "47ì•”í–‰ì–´ì‚¬";
           if ((month1 === 3 && month2 === 7) || (month1 === 7 && month2 === 3)) return "37ë•¡ì¡ì´";
           
           if (month1 === month2) return month1 + "ë•¡";
           
           if (months[0] === 1) {
               if (months[1] === 2) return "ì•Œë¦¬";
               if (months[1] === 4) return "ë…ì‚¬";
               if (months[1] === 9) return "êµ¬ì‚¥";
               if (months[1] === 10) return "ì¥ì‚¥";
           }
           
           const kut = (month1 + month2) % 10;
           if (kut === 9) return "ê°‘ì˜¤";
           if (months[0] === 4) {
               if (months[1] === 10) return "ì¥ì‚¬";
               if (months[1] === 6) return "ì„¸ë¥™";
           }
           
           if (kut === 0) return "ë§í†µ";
           return kut + "ë—";
       }

       function updatePokkalHighlight(pokkal) {
           document.querySelectorAll('.pokkal-list li').forEach(li => {
               li.classList.remove('current');
           });

           if (pokkal) {
               const pokkalElement = document.querySelector(`.pokkal-list li[data-pokkal="${pokkal}"]`);
               if (pokkalElement) {
                   pokkalElement.classList.add('current');
               }
           }
       }

       function togglePokkal() {
           const content = document.querySelector('.pokkal-content');
           content.classList.toggle('hidden');
       }

       function startGame() {
            gameEnded = false;

            if (ws && ws.readyState === WebSocket.OPEN) {
                ws.send(JSON.stringify({
                    type: 'start',
                    playerId: playerId,
                    roomCode: currentRoom
                }));
            }
        }

        function endGame() {
            gameEnded = true;

            // ì²« ê²Œì„ì´ ëë‚¬ì„ ë•Œ ì„¤ëª… ìˆ¨ê¸°ê¸°
            if (isFirstGame) {
                if (document.getElementById('cardInstructions')) {
                    document.getElementById('cardInstructions').style.display = 'none';
                }
                isFirstGame = false;
            }
            
            if (ws && ws.readyState === WebSocket.OPEN) {
                ws.send(JSON.stringify({
                    type: 'end',
                    playerId: playerId,
                    roomCode: currentRoom
                }));
            }
        }

       window.addEventListener('load', () => {
           preloadImages();
           connectWebSocket();

           document.getElementById('room-code-input').addEventListener('input', (e) => {
               e.target.value = e.target.value.replace(/[^0-9]/g, '').slice(0, 4);
           });

           document.getElementById('playerName').addEventListener('keypress', (e) => {
               if (e.key === 'Enter') {
                   const roomCode = document.getElementById('room-code-input').value;
                   if (roomCode) {
                       joinRoom();
                   } else {
                       createRoom();
                   }
               }
           });

           document.getElementById('room-code-input').addEventListener('keypress', (e) => {
               if (e.key === 'Enter') {
                   joinRoom();
               }
           });
       });
   </script>
</body>
</html>
